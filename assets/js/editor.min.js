$gp.editor=function(t){return{current:null,init:function(t){$gp.init(),$gp.editor.table=t,$gp.editor.install_hooks()},original_id_from_row_id:function(t){return t.split("-")[0]},translation_id_from_row_id:function(t){return t.split("-")[1]},show:function(e){var r=e.closest("tr").attr("row"),i=t("#editor-"+r);i.length&&($gp.editor.current&&$gp.editor.hide(),i.preview=t("#preview-"+r),i.row_id=r,i.original_id=$gp.editor.original_id_from_row_id(r),i.translation_id=$gp.editor.translation_id_from_row_id(r),$gp.editor.current=i,i.show(),i.preview.hide(),t("tr:first",$gp.editor.table).hide(),t("textarea:first",i).focus())},prev:function(){var t;$gp.editor.current&&(t=$gp.editor.current.prevAll("tr.editor"),t.length?$gp.editor.show(t.eq(0)):$gp.editor.hide())},next:function(){var t;$gp.editor.current&&(t=$gp.editor.current.nextAll("tr.editor"),t.length?$gp.editor.show(t.eq(0)):$gp.editor.hide())},hide:function(e){e=e?e:$gp.editor.current,e&&(e.hide(),e.preview.show(),t("tr:first",$gp.editor.table).show(),$gp.editor.current=null)},install_hooks:function(){t($gp.editor.table).on("click","a.edit",$gp.editor.hooks.show).on("dblclick","tr.preview td",$gp.editor.hooks.show).on("change","select.priority",$gp.editor.hooks.set_priority).on("click","a.close",$gp.editor.hooks.hide).on("click","a.copy",$gp.editor.hooks.copy).on("click","a.discard-warning",$gp.editor.hooks.discard_warning).on("click","button.approve",$gp.editor.hooks.set_status_current).on("click","button.reject",$gp.editor.hooks.set_status_rejected).on("click","button.ok",$gp.editor.hooks.ok).on("keydown","tr.editor textarea",$gp.editor.hooks.keydown),t("#translations").tooltip({items:".glossary-word",content:function(){var e=t("<ul>");return t.each(t(this).data("translations"),function(r,i){var o=t("<li>");o.append(t("<span>",{text:i.pos}).addClass("pos")),o.append(t("<span>",{text:i.translation}).addClass("translation")),o.append(t("<span>",{text:i.comment}).addClass("comment")),e.append(o)}),e},hide:!1,show:!1})},keydown:function(e){var r,i;if(27===e.keyCode)$gp.editor.hide();else if(33===e.keyCode)$gp.editor.prev();else if(34===e.keyCode)$gp.editor.next();else{if(13!==e.keyCode||!e.shiftKey)return!0;r=t(e.target),0===e.altKey&&r.val().length&&(i=r.closest(".textareas").prev(),i.children()?r.val(i.find(".original").text()):r.val(i.text())),r.nextAll("textarea").length?r.nextAll("textarea").eq(0).focus():$gp.editor.save(r.parents("tr.editor").find("button.ok"))}return!1},replace_current:function(t){var e;$gp.editor.current&&($gp.editor.current.after(t),e=$gp.editor.current,e.attr("id",e.attr("id")+"-old"),$gp.editor.next(),e.preview.remove(),e.remove(),$gp.editor.current.preview.fadeIn(800))},save:function(e){var r,i,o,n=[];$gp.editor.current&&(r=$gp.editor.current,e.prop("disabled",!0),$gp.notices.notice("Saving&hellip;"),n={original_id:r.original_id,_gp_route_nonce:e.data("nonce")},i="translation["+r.original_id+"][]",o=t('textarea[name="'+i+'"]',r).map(function(){return this.value}).get(),n[i]=o,t.ajax({type:"POST",url:$gp_editor_options.url,data:n,dataType:"json",success:function(t){var r;e.prop("disabled",!1),$gp.notices.success("Saved!");for(r in t)$gp.editor.replace_current(t[r]);$gp.editor.current.hasClass("no-warnings")?$gp.editor.next():$gp.editor.current.preview.hide()},error:function(t,r){e.prop("disabled",!1),r=t.responseText?"Error: "+t.responseText:"Error saving the translation!",$gp.notices.error(r)}}))},set_priority:function(e){var r,i;$gp.editor.current&&(r=$gp.editor.current,e.prop("disabled",!0),$gp.notices.notice("Setting priority&hellip;"),i={priority:t("option:selected",e).val(),_gp_route_nonce:e.data("nonce")},t.ajax({type:"POST",url:$gp_editor_options.set_priority_url.replace("%original-id%",r.original_id),data:i,success:function(){var r;e.prop("disabled",!1),$gp.notices.success("Priority set!"),r="priority-"+t("option:selected",e).text(),$gp.editor.current.addClass(r),$gp.editor.current.preview.addClass(r)},error:function(t,r){e.prop("disabled",!1),r=t.responseText?"Error: "+t.responseText:"Error setting the priority!",$gp.notices.error(r)}}))},set_status:function(e,r){var i,o;$gp.editor.current&&$gp.editor.current.translation_id&&(i=$gp.editor.current,e.prop("disabled",!0),$gp.notices.notice("Setting status to &#8220;"+r+"&#8221;&hellip;"),o={translation_id:i.translation_id,status:r,_gp_route_nonce:e.data("nonce")},t.ajax({type:"POST",url:$gp_editor_options.set_status_url,data:o,success:function(t){e.prop("disabled",!1),$gp.notices.success("Status set!"),$gp.editor.replace_current(t),$gp.editor.next()},error:function(t,r){e.prop("disabled",!1),r=t.responseText?"Error: "+t.responseText:"Error setting the status!",$gp.notices.error(r)}}))},discard_warning:function(e){var r;$gp.editor.current&&($gp.notices.notice("Discarding&hellip;"),r={translation_id:$gp.editor.current.translation_id,key:e.data("key"),index:e.data("index"),_gp_route_nonce:e.data("nonce")},t.ajax({type:"POST",url:$gp_editor_options.discard_warning_url,data:r,success:function(t){$gp.notices.success("Saved!"),$gp.editor.replace_current(t)},error:function(t,e){e=t.responseText?"Error: "+t.responseText:"Error saving the translation!",$gp.notices.error(e)}}))},copy:function(t){var e=t.parents(".textareas").prev().find(".original");e.hasClass("original")||(e=t.parents(".strings").find(".original").last()),e=e.text(),e=e.replace(/<span class=.invisibles.*?<\/span>/g,""),t.parents(".textareas").find("textarea").val(e).focus()},hooks:{show:function(){return $gp.editor.show(t(this)),!1},hide:function(){return $gp.editor.hide(),!1},ok:function(){return $gp.editor.save(t(this)),!1},keydown:function(t){return $gp.editor.keydown(t)},copy:function(){return $gp.editor.copy(t(this)),!1},discard_warning:function(){return $gp.editor.discard_warning(t(this)),!1},set_status_current:function(){return $gp.editor.set_status(t(this),"current"),!1},set_status_rejected:function(){return $gp.editor.set_status(t(this),"rejected"),!1},set_priority:function(){return $gp.editor.set_priority(t(this)),!1}}}}(jQuery),jQuery(function(t){$gp.editor.init(t("#translations"))});