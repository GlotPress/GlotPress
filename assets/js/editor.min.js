$gp.editor=function(e){return{current:null,init:function(e){$gp.init(),$gp.editor.table=e,$gp.editor.install_hooks()},original_id_from_row_id:function(e){return e.split("-")[0]},translation_id_from_row_id:function(e){return e.split("-")[1]},show:function(t){var r=t.closest("tr").attr("row"),i=e("#editor-"+r);i.length&&($gp.editor.current&&$gp.editor.hide(),i.preview=e("#preview-"+r),i.row_id=r,i.original_id=$gp.editor.original_id_from_row_id(r),i.translation_id=$gp.editor.translation_id_from_row_id(r),$gp.editor.current=i,i.show(),i.preview.hide(),e("tr:first",$gp.editor.table).hide(),e("textarea:first",i).focus())},prev:function(){var e;$gp.editor.current&&(e=$gp.editor.current.prevAll("tr.editor"),e.length?$gp.editor.show(e.eq(0)):$gp.editor.hide())},next:function(){var e;$gp.editor.current&&(e=$gp.editor.current.nextAll("tr.editor"),e.length?$gp.editor.show(e.eq(0)):$gp.editor.hide())},hide:function(t){t=t?t:$gp.editor.current,t&&(t.hide(),t.preview.show(),e("tr:first",$gp.editor.table).show(),$gp.editor.current=null)},install_hooks:function(){e($gp.editor.table).on("click","a.edit",$gp.editor.hooks.show).on("dblclick","tr.preview td",$gp.editor.hooks.show).on("change","select.priority",$gp.editor.hooks.set_priority).on("click","a.close",$gp.editor.hooks.hide).on("click","a.copy",$gp.editor.hooks.copy).on("click","a.discard-warning",$gp.editor.hooks.discard_warning).on("click","button.approve",$gp.editor.hooks.set_status_current).on("click","button.reject",$gp.editor.hooks.set_status_rejected).on("click","button.fuzzy",$gp.editor.hooks.set_status_fuzzy).on("click","button.ok",$gp.editor.hooks.ok).on("keydown","tr.editor textarea",$gp.editor.hooks.keydown),e("#translations").tooltip({items:".glossary-word",content:function(){var t=e("<ul>");return e.each(e(this).data("translations"),function(r,i){var o=e("<li>");o.append(e("<span>",{text:i.pos}).addClass("pos")),o.append(e("<span>",{text:i.translation}).addClass("translation")),o.append(e("<span>",{text:i.comment}).addClass("comment")),t.append(o)}),t},hide:!1,show:!1})},keydown:function(t){var r,i,o,n,s;if(27===t.keyCode||90===t.keyCode&&t.shiftKey&&t.ctrlKey)$gp.editor.hide();else if(33===t.keyCode||38===t.keyCode&&t.ctrlKey)$gp.editor.prev();else if(34===t.keyCode||40===t.keyCode&&t.ctrlKey)$gp.editor.next();else if(13===t.keyCode&&t.shiftKey)r=e(t.target),0===t.altKey&&r.val().length&&(i=r.closest(".textareas").prev(),i.children()?r.val(i.find(".original").text()):r.val(i.text())),r.nextAll("textarea").length?r.nextAll("textarea").eq(0).focus():$gp.editor.save(r.parents("tr.editor").find("button.ok"));else if(13===t.keyCode&&t.ctrlKey||66===t.keyCode&&t.shiftKey&&t.ctrlKey)s=e(".editor:visible").find(".copy"),s.length>0&&s.trigger("click");else if(107===t.keyCode&&t.ctrlKey||65===t.keyCode&&t.shiftKey&&t.ctrlKey)o=e(".editor:visible").find(".approve"),o.length>0&&o.trigger("click");else if(109===t.keyCode&&t.ctrlKey||82===t.keyCode&&t.shiftKey&&t.ctrlKey)n=e(".editor:visible").find(".reject"),n.length>0&&n.trigger("click");else{if(!(192===t.keyCode&&t.ctrlKey||192===t.keyCode&&t.shiftKey&&t.ctrlKey))return!0;n=e(".editor:visible").find(".fuzzy"),n.length>0&&n.trigger("click")}return!1},replace_current:function(e){var t;$gp.editor.current&&($gp.editor.current.after(e),t=$gp.editor.current,t.attr("id",t.attr("id")+"-old"),$gp.editor.next(),t.preview.remove(),t.remove(),$gp.editor.current.preview.fadeIn(800))},save:function(t){var r,i,o,n=[];$gp.editor.current&&(r=$gp.editor.current,t.prop("disabled",!0),$gp.notices.notice("Saving&hellip;"),n={original_id:r.original_id,_gp_route_nonce:t.data("nonce")},i="translation["+r.original_id+"][]",o=e('textarea[name="'+i+'"]',r).map(function(){return this.value}).get(),n[i]=o,e.ajax({type:"POST",url:$gp_editor_options.url,data:n,dataType:"json",success:function(e){var r;t.prop("disabled",!1),$gp.notices.success("Saved!");for(r in e)$gp.editor.replace_current(e[r]);$gp.editor.current.hasClass("no-warnings")?$gp.editor.next():$gp.editor.current.preview.hide()},error:function(e,r){t.prop("disabled",!1),r=e.responseText?"Error: "+e.responseText:"Error saving the translation!",$gp.notices.error(r)}}))},set_priority:function(t){var r,i;$gp.editor.current&&(r=$gp.editor.current,t.prop("disabled",!0),$gp.notices.notice("Setting priority&hellip;"),i={priority:e("option:selected",t).val(),_gp_route_nonce:t.data("nonce")},e.ajax({type:"POST",url:$gp_editor_options.set_priority_url.replace("%original-id%",r.original_id),data:i,success:function(){var r;t.prop("disabled",!1),$gp.notices.success("Priority set!"),r="priority-"+e("option:selected",t).text(),$gp.editor.current.addClass(r),$gp.editor.current.preview.addClass(r)},error:function(e,r){t.prop("disabled",!1),r=e.responseText?"Error: "+e.responseText:"Error setting the priority!",$gp.notices.error(r)}}))},set_status:function(t,r){var i,o;$gp.editor.current&&$gp.editor.current.translation_id&&(i=$gp.editor.current,t.prop("disabled",!0),$gp.notices.notice("Setting status to &#8220;"+r+"&#8221;&hellip;"),o={translation_id:i.translation_id,status:r,_gp_route_nonce:t.data("nonce")},e.ajax({type:"POST",url:$gp_editor_options.set_status_url,data:o,success:function(e){t.prop("disabled",!1),$gp.notices.success("Status set!"),$gp.editor.replace_current(e),$gp.editor.next()},error:function(e,r){t.prop("disabled",!1),r=e.responseText?"Error: "+e.responseText:"Error setting the status!",$gp.notices.error(r)}}))},discard_warning:function(t){var r;$gp.editor.current&&($gp.notices.notice("Discarding&hellip;"),r={translation_id:$gp.editor.current.translation_id,key:t.data("key"),index:t.data("index"),_gp_route_nonce:t.data("nonce")},e.ajax({type:"POST",url:$gp_editor_options.discard_warning_url,data:r,success:function(e){$gp.notices.success("Saved!"),$gp.editor.replace_current(e)},error:function(e,t){t=e.responseText?"Error: "+e.responseText:"Error saving the translation!",$gp.notices.error(t)}}))},copy:function(e){var t=e.parents(".textareas").find("textarea").attr("id").split("_"),r=parseInt(t[t.length-1],10),i=e.parents(".textareas").prev().find(".original").eq(r);i.hasClass("original")||(i=e.parents(".strings").find(".original").eq(r)),i=i.text(),i=i.replace(/<span class=.invisibles.*?<\/span>/g,""),e.parents(".textareas").find("textarea").val(i).focus()},hooks:{show:function(){return $gp.editor.show(e(this)),!1},hide:function(){return $gp.editor.hide(),!1},ok:function(){return $gp.editor.save(e(this)),!1},keydown:function(e){return $gp.editor.keydown(e)},copy:function(){return $gp.editor.copy(e(this)),!1},discard_warning:function(){return $gp.editor.discard_warning(e(this)),!1},set_status_current:function(){return $gp.editor.set_status(e(this),"current"),!1},set_status_rejected:function(){return $gp.editor.set_status(e(this),"rejected"),!1},set_status_fuzzy:function(){return $gp.editor.set_status(e(this),"fuzzy"),!1},set_priority:function(){return $gp.editor.set_priority(e(this)),!1}}}}(jQuery),jQuery(function(e){$gp.editor.init(e("#translations"))});