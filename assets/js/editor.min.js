$gp.editor=function(n){return{current:null,orginal_translations:null,init:function(e){$gp.init(),$gp.editor.table=e,$gp.editor.install_hooks(),1===(e=$gp.editor.table.find("tr.preview")).length&&$gp.editor.show(e.eq(0))},original_id_from_row_id:function(e){return e.split("-")[0]},translation_id_from_row_id:function(e){return e.split("-")[1]},show:function(e){var e=e.closest("tr").attr("row"),t=n("#editor-"+e),r=n("#gmt-date-added-"+e),i=n("#local-date-added-"+e),o=(new Date).getTimezoneOffset(),r=new Date(r.text()),r=new Date(r-60*o*1e3);t.length&&($gp.editor.current&&$gp.editor.hide(),t.preview=n("#preview-"+e),t.row_id=e,t.original_id=$gp.editor.original_id_from_row_id(e),t.translation_id=$gp.editor.translation_id_from_row_id(e),t.orginal_translations=n('textarea[name="translation['+t.original_id+'][]"]',t).map(function(){return this.value}).get(),$gp.editor.current=t,i.text(r.toLocaleDateString()+" "+r.toLocaleTimeString()),t.show(),t.preview.hide(),n("textarea:first",t).focus())},prev:function(){var e;$gp.editor.current&&((e=$gp.editor.current.prevAll("tr.editor")).length?$gp.editor.show(e.eq(0)):$gp.editor.hide())},next:function(){var e;$gp.editor.current&&((e=$gp.editor.current.nextAll("tr.editor")).length?$gp.editor.show(e.eq(0)):$gp.editor.hide())},hide:function(e){(e=e||$gp.editor.current)&&(e.hide(),e.preview.show(),$gp.editor.current=null)},install_hooks:function(){n($gp.editor.table).on("click","a.edit",$gp.editor.hooks.show).on("dblclick","tr.preview td",$gp.editor.hooks.show).on("change","select.priority",$gp.editor.hooks.set_priority).on("contextmenu",".strings > .original > .glossary-word",$gp.editor.hooks.contextmenu_glossary).on("click","button.close",$gp.editor.hooks.cancel).on("click","a.discard-warning",$gp.editor.hooks.discard_warning).on("click","button.copy",$gp.editor.hooks.copy).on("click","button.inserttab",$gp.editor.hooks.tab).on("click","button.insertnl",$gp.editor.hooks.newline).on("click","button.approve",$gp.editor.hooks.set_status_current).on("click","button.reject",$gp.editor.hooks.set_status_rejected).on("click","button.fuzzy",$gp.editor.hooks.set_status_fuzzy).on("click","button.ok",$gp.editor.hooks.ok).on("keydown","tr.editor textarea",$gp.editor.hooks.keydown),n("#translations").tooltip({items:".glossary-word",content:function(){var i=n("<ul>");return n.each(n(this).data("translations"),function(e,t){var r=n("<li>");t.locale_entry&&r.append(n("<span>",{text:t.locale_entry}).addClass("locale-entry bubble")),r.append(n("<span>",{text:t.pos}).addClass("pos")),r.append(n("<span>",{text:t.translation}).addClass("translation")),r.append(n("<span>",{text:t.comment}).addClass("comment")),i.append(r)}),i},hide:!1,show:!1}),n.valHooks.textarea={get:function(e){return e.value.replace(/\r?\n/g,"\r\n")}}},keydown:function(e){var t,r,i,o;if(27===e.keyCode||90===e.keyCode&&e.shiftKey&&e.ctrlKey||90===e.keyCode&&e.shiftKey&&e.metaKey)$gp.editor.hide();else if(33===e.keyCode||38===e.keyCode&&e.ctrlKey||38===e.keyCode&&e.metaKey)$gp.editor.prev();else if(34===e.keyCode||40===e.keyCode&&e.ctrlKey||40===e.keyCode&&e.metaKey)$gp.editor.next();else if(13===e.keyCode&&e.shiftKey||13===e.keyCode&&e.ctrlKey||13===e.keyCode&&e.metaKey)o=n(e.target),0===e.altKey&&o.val().length&&((i=o.closest(".textareas").prev()).children()?o.val(i.find(".original").text()):o.val(i.text())),o.nextAll("textarea").length?o.nextAll("textarea").eq(0).focus():$gp.editor.save(o.parents("tr.editor").find("button.ok"));else if(66===e.keyCode&&e.shiftKey&&e.ctrlKey||67===e.keyCode&&e.shiftKey&&e.ctrlKey||66===e.keyCode&&e.shiftKey&&e.metaKey||67===e.keyCode&&e.shiftKey&&e.metaKey)0<(i=n(".editor:visible").find(".copy")).length&&i.trigger("click");else if(107===e.keyCode&&e.ctrlKey||107===e.keyCode&&e.metaKey||65===e.keyCode&&e.shiftKey&&e.ctrlKey||65===e.keyCode&&e.shiftKey&&e.metaKey)0<(o=n(".editor:visible").find(".approve")).length&&o.trigger("click");else if(109===e.keyCode&&e.ctrlKey||109===e.keyCode&&e.metaKey||82===e.keyCode&&e.shiftKey&&e.ctrlKey||82===e.keyCode&&e.shiftKey&&e.metaKey)0<(t=n(".editor:visible").find(".reject")).length&&t.trigger("click");else if(192===e.keyCode&&e.ctrlKey||192===e.keyCode&&e.shiftKey&&e.ctrlKey||192===e.keyCode&&e.metaKey||192===e.keyCode&&e.shiftKey&&e.metaKey||70===e.keyCode&&e.shiftKey&&e.ctrlKey||70===e.keyCode&&e.shiftKey&&e.metaKey)0<(t=n(".editor:visible").find(".fuzzy")).length&&t.trigger("click");else if(68===e.keyCode&&!e.shiftKey&&e.ctrlKey||68===e.keyCode&&!e.shiftKey&&e.metaKey)0<(r=n(".editor:visible").find(".discard-warning")).length&&r.trigger("click");else if(68===e.keyCode&&e.shiftKey&&e.ctrlKey||68===e.keyCode&&e.shiftKey&&e.metaKey)n("table > tbody  > tr").each(function(){0<(r=n(this).find(".discard-warning")).length&&($gp.editor.show(n(this)),r.trigger("click"))});else if(37===e.keyCode&&e.ctrlKey||37===e.keyCode&&e.metaKey)0<(i=n(".gp-table-actions.top").find(".previous")).length&&(window.location.href=i.attr("href"));else{if(!(39===e.keyCode&&e.ctrlKey||39===e.keyCode&&e.metaKey))return!0;0<(o=n(".gp-table-actions.top").find(".next")).length&&(window.location.href=o.attr("href"))}return!1},replace_current:function(e){$gp.editor.current&&($gp.editor.current.after(e),(e=$gp.editor.current).attr("id",e.attr("id")+"-old"),e.preview.attr("id",e.preview.attr("id")+"-old"),$gp.editor.next(),e.preview.remove(),e.remove())},save:function(r){var e,t,i=[];$gp.editor.current&&(t=$gp.editor.current,r.prop("disabled",!0),$gp.notices.notice("Saving&hellip;"),i={original_id:t.original_id,_gp_route_nonce:r.data("nonce")},e="translation["+t.original_id+"][]",t=n('textarea[name="'+e+'"]',t).map(function(){return this.value}).get(),i[e]=t,n.ajax({type:"POST",url:$gp_editor_options.url,data:i,dataType:"json",success:function(e){for(var t in r.prop("disabled",!1),$gp.notices.success("Saved!"),e)$gp.editor.replace_current(e[t]);$gp.editor.current.hasClass("no-warnings")&&$gp.editor.next()},error:function(e,t){r.prop("disabled",!1),t=e.responseText?"Error: "+e.responseText:"Error saving the translation!",$gp.notices.error(t)}}))},set_priority:function(r){var e,t;$gp.editor.current&&(e=$gp.editor.current,r.prop("disabled",!0),$gp.notices.notice("Setting priority&hellip;"),t={priority:n("option:selected",r).val(),_gp_route_nonce:r.data("nonce")},n.ajax({type:"POST",url:$gp_editor_options.set_priority_url.replace("%original-id%",e.original_id),data:t,success:function(){var e;r.prop("disabled",!1),$gp.notices.success("Priority set!"),e="priority-"+n("option:selected",r).text(),$gp.editor.current.addClass(e),$gp.editor.current.preview.addClass(e)},error:function(e,t){r.prop("disabled",!1),t=e.responseText?"Error: "+e.responseText:"Error setting the priority!",$gp.notices.error(t)}}))},set_status:function(r,e){var t,i=!1;$gp.editor.current&&$gp.editor.current.translation_id&&(t=$gp.editor.current,n('[id*="translation_'+t.original_id+'_"]').each(function(){this.value!==this.defaultValue&&(i=!0)}),i?$gp.notices.error("Translation has changed! Please add the new translation before changing its status."):(r.prop("disabled",!0),$gp.notices.notice("Setting status to &#8220;"+e+"&#8221;&hellip;"),t={translation_id:t.translation_id,status:e,_gp_route_nonce:r.data("nonce")},n.ajax({type:"POST",url:$gp_editor_options.set_status_url,data:t,success:function(e){r.prop("disabled",!1),$gp.notices.success("Status set!"),$gp.editor.replace_current(e),$gp.editor.next()},error:function(e,t){r.prop("disabled",!1),t=e.responseText?"Error: "+e.responseText:"Error setting the status!",$gp.notices.error(t)}})))},discard_warning:function(e){$gp.editor.current&&($gp.notices.notice("Discarding&hellip;"),e={translation_id:$gp.editor.current.translation_id,key:e.data("key"),index:e.data("index"),_gp_route_nonce:e.data("nonce")},n.ajax({type:"POST",url:$gp_editor_options.discard_warning_url,data:e,success:function(e){$gp.notices.success("Saved!"),$gp.editor.replace_current(e)},error:function(e,t){t=e.responseText?"Error: "+e.responseText:"Error saving the translation!",$gp.notices.error(t)}}))},copy:function(e){var t=e.parents(".textareas").find("textarea").attr("id").split("_"),t=Math.min(parseInt(t[t.length-1],10),1),t=e.parents(".strings").find(".original_raw").eq(t).text();e.parents(".textareas").find("textarea").val(t).focus()},tab:function(e){var e=e.parents(".textareas").find("textarea"),t=e.prop("selectionStart"),r=e.val(),i=r.substring(0,t),r=r.substring(t,r.length);e.val(i+"\t"+r),e.focus(),e[0].selectionEnd=t+1},newline:function(e){var e=e.parents(".textareas").find("textarea"),t=e.prop("selectionStart"),r=e.val(),i=r.substring(0,t),r=r.substring(t,r.length);e.val(i+"\n"+r),e.focus(),e[0].selectionEnd=t+1},hooks:{show:function(){return $gp.editor.show(n(this)),!1},hide:function(){return $gp.editor.hide(),!1},ok:function(){return $gp.editor.save(n(this)),!1},contextmenu_glossary:function(e){var t=jQuery(this).data("translations");return n(".editor:visible textarea:visible").val(n(".editor:visible textarea:visible").val()+t[0].translation).focus(),e.preventDefault(),!1},cancel:function(){for(var e=0;e<$gp.editor.current.orginal_translations.length;e++)n('textarea[id="translation_'+$gp.editor.current.original_id+"_"+e+'"]').val($gp.editor.current.orginal_translations[e]);return $gp.editor.hide(),!1},keydown:function(e){return $gp.editor.keydown(e)},copy:function(){return $gp.editor.copy(n(this)),!1},tab:function(){return $gp.editor.tab(n(this)),!1},newline:function(){return $gp.editor.newline(n(this)),!1},discard_warning:function(){return $gp.editor.discard_warning(n(this)),!1},set_status_current:function(){return $gp.editor.set_status(n(this),"current"),!1},set_status_rejected:function(){return $gp.editor.set_status(n(this),"rejected"),!1},set_status_fuzzy:function(){return $gp.editor.set_status(n(this),"fuzzy"),!1},set_priority:function(){return $gp.editor.set_priority(n(this)),!1}}}}(jQuery),jQuery(function(e){$gp.editor.init(e("#translations"))});