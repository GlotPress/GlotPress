$gp.editor=(function(a){return{current:null,orginal_translations:null,init:function(b){var c;$gp.init();$gp.editor.table=b;$gp.editor.install_hooks();c=$gp.editor.table.find("tr.preview");if(1===c.length){c.eq(0).find("a.edit").trigger("click");}},original_id_from_row_id:function(b){return b.split("-")[0];},translation_id_from_row_id:function(b){return b.split("-")[1];},show:function(c){var b=c.closest("tr").attr("row");var d=a("#editor-"+b);if(!d.length){return;}if($gp.editor.current){$gp.editor.hide();}d.preview=a("#preview-"+b);d.row_id=b;d.original_id=$gp.editor.original_id_from_row_id(b);d.translation_id=$gp.editor.translation_id_from_row_id(b);d.orginal_translations=a('textarea[name="translation['+d.original_id+'][]"]',d).map(function(){return this.value;}).get();$gp.editor.current=d;d.show();d.preview.hide();a("tr:first",$gp.editor.table).hide();a("textarea:first",d).focus();},prev:function(){var b;if(!$gp.editor.current){return;}b=$gp.editor.current.prevAll("tr.editor");if(b.length){$gp.editor.show(b.eq(0));}else{$gp.editor.hide();}},next:function(){var b;if(!$gp.editor.current){return;}b=$gp.editor.current.nextAll("tr.editor");if(b.length){$gp.editor.show(b.eq(0));}else{$gp.editor.hide();}},hide:function(b){b=b?b:$gp.editor.current;if(!b){return;}b.hide();b.preview.show();a("tr:first",$gp.editor.table).show();$gp.editor.current=null;},install_hooks:function(){a($gp.editor.table).on("click","a.edit",$gp.editor.hooks.show).on("dblclick","tr.preview td",$gp.editor.hooks.show).on("change","select.priority",$gp.editor.hooks.set_priority).on("click","a.close",$gp.editor.hooks.cancel).on("click","a.copy",$gp.editor.hooks.copy).on("click","a.discard-warning",$gp.editor.hooks.discard_warning).on("click","button.approve",$gp.editor.hooks.set_status_current).on("click","button.reject",$gp.editor.hooks.set_status_rejected).on("click","button.fuzzy",$gp.editor.hooks.set_status_fuzzy).on("click","button.ok",$gp.editor.hooks.ok).on("keydown","tr.editor textarea",$gp.editor.hooks.keydown);a("#translations").tooltip({items:".glossary-word",content:function(){var b=a("<ul>");a.each(a(this).data("translations"),function(c,f){var d=a("<li>");if(f.locale_entry){d.append(a("<span>",{text:f.locale_entry}).addClass("locale-entry bubble"));}d.append(a("<span>",{text:f.pos}).addClass("pos"));d.append(a("<span>",{text:f.translation}).addClass("translation"));d.append(a("<span>",{text:f.comment}).addClass("comment"));b.append(d);});return b;},hide:false,show:false});a.valHooks.textarea={get:function(b){return b.value.replace(/\r?\n/g,"\r\n");}};},keydown:function(g){var f,b,d,c,h;if(27===g.keyCode||(90===g.keyCode&&g.shiftKey&&g.ctrlKey)){$gp.editor.hide();}else{if(33===g.keyCode||(38===g.keyCode&&g.ctrlKey)){$gp.editor.prev();}else{if(34===g.keyCode||(40===g.keyCode&&g.ctrlKey)){$gp.editor.next();}else{if(13===g.keyCode&&g.shiftKey){f=a(g.target);if(0===g.altKey&&f.val().length){b=f.closest(".textareas").prev();if(b.children()){f.val(b.find(".original").text());}else{f.val(b.text());}}if(f.nextAll("textarea").length){f.nextAll("textarea").eq(0).focus();}else{$gp.editor.save(f.parents("tr.editor").find("button.ok"));}}else{if((13===g.keyCode&&g.ctrlKey)||(66===g.keyCode&&g.shiftKey&&g.ctrlKey)){h=a(".editor:visible").find(".copy");if(h.length>0){h.trigger("click");}}else{if((107===g.keyCode&&g.ctrlKey)||(65===g.keyCode&&g.shiftKey&&g.ctrlKey)){d=a(".editor:visible").find(".approve");if(d.length>0){d.trigger("click");}}else{if((109===g.keyCode&&g.ctrlKey)||(82===g.keyCode&&g.shiftKey&&g.ctrlKey)){c=a(".editor:visible").find(".reject");if(c.length>0){c.trigger("click");}}else{if((192===g.keyCode&&g.ctrlKey)||(192===g.keyCode&&g.shiftKey&&g.ctrlKey)){c=a(".editor:visible").find(".fuzzy");if(c.length>0){c.trigger("click");}}else{return true;}}}}}}}}return false;},replace_current:function(b){var c;if(!$gp.editor.current){return;}$gp.editor.current.after(b);c=$gp.editor.current;c.attr("id",c.attr("id")+"-old");c.preview.attr("id",c.preview.attr("id")+"-old");$gp.editor.next();c.preview.remove();c.remove();},save:function(c){var d,f,e=[],b;if(!$gp.editor.current){return;}d=$gp.editor.current;c.prop("disabled",true);$gp.notices.notice("Saving&hellip;");e={original_id:d.original_id,_gp_route_nonce:c.data("nonce")};f="translation["+d.original_id+"][]";b=a('textarea[name="'+f+'"]',d).map(function(){return this.value;}).get();e[f]=b;a.ajax({type:"POST",url:$gp_editor_options.url,data:e,dataType:"json",success:function(g){var h;c.prop("disabled",false);$gp.notices.success("Saved!");for(h in g){$gp.editor.replace_current(g[h]);}if($gp.editor.current.hasClass("no-warnings")){$gp.editor.next();}},error:function(h,g){c.prop("disabled",false);g=h.responseText?"Error: "+h.responseText:"Error saving the translation!";$gp.notices.error(g);}});},set_priority:function(b){var c,d;if(!$gp.editor.current){return;}c=$gp.editor.current;b.prop("disabled",true);$gp.notices.notice("Setting priority&hellip;");d={priority:a("option:selected",b).val(),_gp_route_nonce:b.data("nonce")};a.ajax({type:"POST",url:$gp_editor_options.set_priority_url.replace("%original-id%",c.original_id),data:d,success:function(){var e;b.prop("disabled",false);$gp.notices.success("Priority set!");e="priority-"+a("option:selected",b).text();$gp.editor.current.addClass(e);$gp.editor.current.preview.addClass(e);},error:function(f,e){b.prop("disabled",false);e=f.responseText?"Error: "+f.responseText:"Error setting the priority!";$gp.notices.error(e);}});},set_status:function(c,b){var d,f,e=false;if(!$gp.editor.current||!$gp.editor.current.translation_id){return;}d=$gp.editor.current;a('[id*="translation_'+d.original_id+'_"]').each(function(){if(this.value!==this.defaultValue){e=true;}});if(e){$gp.notices.error("Translation has changed! Please add the new translation before changing it's status.");return;}c.prop("disabled",true);$gp.notices.notice("Setting status to &#8220;"+b+"&#8221;&hellip;");f={translation_id:d.translation_id,status:b,_gp_route_nonce:c.data("nonce")};a.ajax({type:"POST",url:$gp_editor_options.set_status_url,data:f,success:function(g){c.prop("disabled",false);$gp.notices.success("Status set!");$gp.editor.replace_current(g);$gp.editor.next();},error:function(h,g){c.prop("disabled",false);g=h.responseText?"Error: "+h.responseText:"Error setting the status!";$gp.notices.error(g);}});},discard_warning:function(b){var c;if(!$gp.editor.current){return;}$gp.notices.notice("Discarding&hellip;");c={translation_id:$gp.editor.current.translation_id,key:b.data("key"),index:b.data("index"),_gp_route_nonce:b.data("nonce")};a.ajax({type:"POST",url:$gp_editor_options.discard_warning_url,data:c,success:function(d){$gp.notices.success("Saved!");$gp.editor.replace_current(d);},error:function(e,d){d=e.responseText?"Error: "+e.responseText:"Error saving the translation!";$gp.notices.error(d);}});},copy:function(d){var e=d.parents(".textareas").find("textarea").attr("id").split("_");var c=parseInt(e[e.length-1],10);var b=d.parents(".textareas").prev().find(".original").eq(c);if(!b.hasClass("original")){b=d.parents(".strings").find(".original").eq(c);}b=b.text();b=b.replace(/<span class=.invisibles.*?<\/span>/g,"");d.parents(".textareas").find("textarea").val(b).focus();},hooks:{show:function(){$gp.editor.show(a(this));return false;},hide:function(){$gp.editor.hide();return false;},ok:function(){$gp.editor.save(a(this));return false;},cancel:function(){var b=0;for(b=0;b<$gp.editor.current.orginal_translations.length;b++){a('textarea[id="translation_'+$gp.editor.current.original_id+"_"+b+'"]').val($gp.editor.current.orginal_translations[b]);}$gp.editor.hide();return false;},keydown:function(b){return $gp.editor.keydown(b);},copy:function(){$gp.editor.copy(a(this));return false;},discard_warning:function(){$gp.editor.discard_warning(a(this));return false;},set_status_current:function(){$gp.editor.set_status(a(this),"current");return false;},set_status_rejected:function(){$gp.editor.set_status(a(this),"rejected");return false;},set_status_fuzzy:function(){$gp.editor.set_status(a(this),"fuzzy");return false;},set_priority:function(){$gp.editor.set_priority(a(this));return false;}}};}(jQuery));jQuery(function(a){$gp.editor.init(a("#translations"));});